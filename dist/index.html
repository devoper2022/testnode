<html>
<header>
    <title>Server Sent Event</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</header>
<body class="container-fluid">
    <div class="row">
        <p id="message"></p>
        <p> Alert : </p>
        <div id="list" class="col-6">
        </div>
    </div>
    <script type="text/javascript">
        var message = document.getElementById('message');
        var list = document.getElementById('list');
        var source = new EventSource('/temp')
        let count = 1;
        source.onmessage = function (event) {
            let temp = parseFloat(event.data.split('temp:')[1]);
            message.innerText = "Current Reading " + temp;
            // console.log("New message", event.data);            
            if (!(102 < temp)) {
                let msg = `Alert: Temperature is Low ${temp}, please correct`;                
                let item = `<div class="alert alert-danger" role="alert" id='${count}'>
                                <span class=''>${msg}</span>
                                <button onclick='deleteTodo(${count})' class='btn btn-success'>Bring Up Temp</button>
                            </div>`;
                count += 1;
                list.innerHTML += item;
                console.log(msg)
            }

            if (102.1 < temp && temp < 102.5) {
                let msg = `Temperature is getting Low ${temp}, please correct`;                
                let item = `<div class="alert alert-warning" role="alert" id='${count}'>
                                <span class=''>${msg}</span>                            
                            </div>`;
                count += 1;
                list.innerHTML += item;
                console.log(msg)
            }

            if (103.5 < temp && temp < 103.9) {
                let msg = `Temperature is getting High ${temp}, please correct`; 
                let item = `<div class="alert alert-warning" role="alert" id='${count}'>
                                <span class=''>${msg}</span>
                            </div>`;
                count += 1;
                list.innerHTML += item;
                console.log(msg)
            }

            if (!(temp < 104)) {
                let msg = `Alert Temperature is High ${temp}, please correct`; 
                let item = `<div class="alert alert-danger" role="alert" id='${count}'>
                                <span class=''>${msg}</span>
                                <button onclick='deleteTodo(${count})' class='btn btn-success'> Bring Down Temp</button>
                            </div>`;
                count += 1;
                list.innerHTML += item;
                console.log(msg)
            }

            if(count == 20){
                list.innerHTML = '';
                count = 0;
            }
        };
        source.onerror = function (err) {
            console.error("EventSource failed:", err);
        }

        function deleteTodo(id) {
            var id = document.getElementById(id);
            id.parentNode.removeChild(id);
            count -= 1;
        }
    </script>
</body>

</html>
